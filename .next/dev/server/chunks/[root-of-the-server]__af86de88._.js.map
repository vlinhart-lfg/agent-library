{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/v.linhart/Desktop/agent-library-2/agent-library/lib/github.ts"],"sourcesContent":["import { Octokit } from '@octokit/rest';\n\n// Initialize GitHub client\nconst octokit = new Octokit({\n  auth: process.env.GITHUB_PAT,\n});\n\nconst REPO_OWNER = process.env.GITHUB_REPO_OWNER || 'vlinhart-lfg';\nconst REPO_NAME = process.env.GITHUB_REPO_NAME || 'agent-library';\nconst REPO_BRANCH = process.env.GITHUB_REPO_BRANCH || 'main';\n\nexport interface ScenarioData {\n  id: string;\n  slug: string;\n  title: string;\n  description: string;\n  fullDescription: string;\n  previewImage: string;\n  category: string;\n  tags: string[];\n  complexity: string;\n  useCase: string;\n  createdAt: string;\n  makeScenarioUrl: string;\n  makeScenarioId: string;\n  makeIframeUrl?: string;\n  makeApps: string[];\n  submittedBy: string;\n  submittedAt: string;\n  status: string;\n  aiEnhanced: boolean;\n}\n\n/**\n * Read current templates.json from GitHub\n */\nasync function readTemplatesJson(): Promise<ScenarioData[]> {\n  try {\n    const { data } = await octokit.repos.getContent({\n      owner: REPO_OWNER,\n      repo: REPO_NAME,\n      path: 'data/templates.json',\n      ref: REPO_BRANCH,\n    });\n\n    if ('content' in data) {\n      const content = Buffer.from(data.content, 'base64').toString('utf-8');\n      return JSON.parse(content);\n    }\n\n    throw new Error('Unable to read templates.json');\n  } catch (error: any) {\n    console.error('Error reading templates.json:', error);\n    throw new Error('Failed to read existing scenarios');\n  }\n}\n\n/**\n * Generate unique slug from title\n */\nfunction generateSlug(title: string, existingSlugs: string[]): string {\n  let slug = title\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '');\n\n  // Handle collisions\n  let finalSlug = slug;\n  let counter = 1;\n  while (existingSlugs.includes(finalSlug)) {\n    finalSlug = `${slug}-${counter}`;\n    counter++;\n  }\n\n  return finalSlug;\n}\n\n/**\n * Extract scenario ID from Make.com URL\n */\nfunction extractScenarioId(url: string): string {\n  const match = url.match(/shared-scenario\\/([^\\/]+)/);\n  return match ? match[1] : '';\n}\n\n/**\n * Check if scenario ID already exists\n */\nexport async function checkDuplicateScenario(makeScenarioUrl: string): Promise<boolean> {\n  try {\n    const templates = await readTemplatesJson();\n    const scenarioId = extractScenarioId(makeScenarioUrl);\n\n    return templates.some(\n      (t) => t.makeScenarioId === scenarioId || t.makeScenarioUrl === makeScenarioUrl\n    );\n  } catch (error) {\n    console.error('Error checking duplicates:', error);\n    return false;\n  }\n}\n\n/**\n * Publish new scenario to GitHub\n */\nexport async function publishScenario(data: {\n  makeScenarioUrl: string;\n  title: string;\n  description: string;\n  apps: string;\n  category: string;\n  iframeUrl?: string;\n  buttonUrl?: string;\n}): Promise<{ success: boolean; scenarioId: string; slug: string }> {\n  try {\n    // Check for duplicates\n    const isDuplicate = await checkDuplicateScenario(data.makeScenarioUrl);\n    if (isDuplicate) {\n      throw new Error('This scenario has already been submitted');\n    }\n\n    // Read current templates\n    const templates = await readTemplatesJson();\n\n    // Generate new ID (increment from max)\n    const maxId = templates.length > 0\n      ? Math.max(...templates.map((t) => parseInt(t.id)))\n      : 0;\n    const newId = (maxId + 1).toString();\n\n    // Generate unique slug\n    const existingSlugs = templates.map((t) => t.slug);\n    const slug = generateSlug(data.title, existingSlugs);\n\n    // Extract scenario ID\n    const makeScenarioId = extractScenarioId(data.makeScenarioUrl);\n\n    // Parse apps\n    const appsArray = data.apps.split(',').map((app) => app.trim());\n\n    // Build new scenario entry\n    const newScenario: ScenarioData = {\n      id: newId,\n      slug,\n      title: data.title,\n      description: data.description,\n      fullDescription: data.description,\n      previewImage: '/placeholder.svg?height=400&width=600',\n      category: data.category,\n      tags: appsArray.map((app) => app.toLowerCase()),\n      complexity: 'Intermediate',\n      useCase: data.description.split('.')[0] || data.description,\n      createdAt: new Date().toISOString().split('T')[0],\n      makeScenarioUrl: data.makeScenarioUrl,\n      makeScenarioId,\n      makeIframeUrl: data.iframeUrl || '',\n      makeApps: appsArray,\n      submittedBy: 'anonymous',\n      submittedAt: new Date().toISOString(),\n      status: 'published',\n      aiEnhanced: true,\n    };\n\n    // Add to templates array\n    const updatedTemplates = [...templates, newScenario];\n\n    // Get current file SHA\n    const { data: fileData } = await octokit.repos.getContent({\n      owner: REPO_OWNER,\n      repo: REPO_NAME,\n      path: 'data/templates.json',\n      ref: REPO_BRANCH,\n    });\n\n    const sha = 'sha' in fileData ? fileData.sha : '';\n\n    // Commit to GitHub\n    const commitMessage = `feat: add ${data.title} scenario via community submission\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>`;\n\n    await octokit.repos.createOrUpdateFileContents({\n      owner: REPO_OWNER,\n      repo: REPO_NAME,\n      path: 'data/templates.json',\n      message: commitMessage,\n      content: Buffer.from(JSON.stringify(updatedTemplates, null, 2)).toString('base64'),\n      sha,\n      branch: REPO_BRANCH,\n    });\n\n    return {\n      success: true,\n      scenarioId: newId,\n      slug,\n    };\n  } catch (error: any) {\n    console.error('Error publishing scenario:', error);\n    throw new Error(error.message || 'Failed to publish scenario to GitHub');\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///Users/v.linhart/Desktop/agent-library-2/agent-library/lib/sanitize.ts"],"sourcesContent":["import DOMPurify from 'isomorphic-dompurify';\n\n/**\n * Sanitize user input to prevent XSS attacks\n */\nexport function sanitizeText(input: string): string {\n  // Remove any HTML tags and potentially malicious content\n  return DOMPurify.sanitize(input, {\n    ALLOWED_TAGS: [], // No HTML tags allowed\n    ALLOWED_ATTR: [],\n  }).trim();\n}\n\n/**\n * Validate and sanitize URL\n */\nexport function sanitizeUrl(url: string, allowedDomains: string[] = []): string {\n  try {\n    const parsed = new URL(url);\n\n    // Check if domain is allowed\n    if (allowedDomains.length > 0) {\n      const isAllowed = allowedDomains.some((domain) =>\n        parsed.hostname.includes(domain)\n      );\n\n      if (!isAllowed) {\n        throw new Error(`URL domain not allowed: ${parsed.hostname}`);\n      }\n    }\n\n    // Only allow https\n    if (parsed.protocol !== 'https:') {\n      throw new Error('Only HTTPS URLs are allowed');\n    }\n\n    return url;\n  } catch (error: any) {\n    throw new Error('Invalid URL: ' + error.message);\n  }\n}\n\n/**\n * Sanitize Make.com iframe URL\n */\nexport function sanitizeMakeIframeUrl(url: string): string {\n  if (!url) return '';\n\n  // Must be from make.com domain\n  return sanitizeUrl(url, ['make.com', 'eu2.make.com', 'us1.make.com']);\n}\n\n/**\n * Sanitize scenario data before storage\n */\nexport function sanitizeScenarioData(data: {\n  title: string;\n  description: string;\n  apps: string;\n  makeScenarioUrl: string;\n  iframeUrl?: string;\n  buttonUrl?: string;\n}): {\n  title: string;\n  description: string;\n  apps: string;\n  makeScenarioUrl: string;\n  iframeUrl?: string;\n  buttonUrl?: string;\n} {\n  return {\n    title: sanitizeText(data.title),\n    description: sanitizeText(data.description),\n    apps: sanitizeText(data.apps),\n    makeScenarioUrl: sanitizeUrl(data.makeScenarioUrl, ['make.com']),\n    iframeUrl: data.iframeUrl ? sanitizeMakeIframeUrl(data.iframeUrl) : undefined,\n    buttonUrl: data.buttonUrl ? sanitizeUrl(data.buttonUrl, ['make.com']) : undefined,\n  };\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAKO,SAAS,aAAa,KAAa;IACxC,yDAAyD;IACzD,OAAO,6JAAS,CAAC,QAAQ,CAAC,OAAO;QAC/B,cAAc,EAAE;QAChB,cAAc,EAAE;IAClB,GAAG,IAAI;AACT;AAKO,SAAS,YAAY,GAAW,EAAE,iBAA2B,EAAE;IACpE,IAAI;QACF,MAAM,SAAS,IAAI,IAAI;QAEvB,6BAA6B;QAC7B,IAAI,eAAe,MAAM,GAAG,GAAG;YAC7B,MAAM,YAAY,eAAe,IAAI,CAAC,CAAC,SACrC,OAAO,QAAQ,CAAC,QAAQ,CAAC;YAG3B,IAAI,CAAC,WAAW;gBACd,MAAM,IAAI,MAAM,CAAC,wBAAwB,EAAE,OAAO,QAAQ,EAAE;YAC9D;QACF;QAEA,mBAAmB;QACnB,IAAI,OAAO,QAAQ,KAAK,UAAU;YAChC,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,MAAM,IAAI,MAAM,kBAAkB,MAAM,OAAO;IACjD;AACF;AAKO,SAAS,sBAAsB,GAAW;IAC/C,IAAI,CAAC,KAAK,OAAO;IAEjB,+BAA+B;IAC/B,OAAO,YAAY,KAAK;QAAC;QAAY;QAAgB;KAAe;AACtE;AAKO,SAAS,qBAAqB,IAOpC;IAQC,OAAO;QACL,OAAO,aAAa,KAAK,KAAK;QAC9B,aAAa,aAAa,KAAK,WAAW;QAC1C,MAAM,aAAa,KAAK,IAAI;QAC5B,iBAAiB,YAAY,KAAK,eAAe,EAAE;YAAC;SAAW;QAC/D,WAAW,KAAK,SAAS,GAAG,sBAAsB,KAAK,SAAS,IAAI;QACpE,WAAW,KAAK,SAAS,GAAG,YAAY,KAAK,SAAS,EAAE;YAAC;SAAW,IAAI;IAC1E;AACF"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///Users/v.linhart/Desktop/agent-library-2/agent-library/app/api/publish/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { publishScenario } from '@/lib/github';\nimport { sanitizeScenarioData } from '@/lib/sanitize';\n\nexport async function POST(request: Request) {\n  try {\n    // Parse request body\n    const body = await request.json();\n\n    // Sanitize inputs\n    const sanitized = sanitizeScenarioData(body);\n\n    // Use AI-suggested enhancements if provided\n    const finalData = {\n      makeScenarioUrl: sanitized.makeScenarioUrl,\n      title: body.suggestedTitle || sanitized.title,\n      description: body.suggestedDescription || sanitized.description,\n      apps: sanitized.apps,\n      category: body.suggestedCategory || body.category,\n      iframeUrl: sanitized.iframeUrl,\n      buttonUrl: sanitized.buttonUrl,\n    };\n\n    // Publish to GitHub\n    const result = await publishScenario(finalData);\n\n    if (!result.success) {\n      return NextResponse.json(\n        {\n          error: 'Failed to publish scenario',\n        },\n        { status: 500 }\n      );\n    }\n\n    // Return success\n    return NextResponse.json({\n      success: true,\n      scenarioId: result.scenarioId,\n      slug: result.slug,\n      url: `/${result.slug}`,\n      message: 'Scenario published successfully! It will appear on the site within 3 minutes.',\n    });\n  } catch (error: any) {\n    console.error('Publish error:', error);\n\n    // Handle duplicate scenarios\n    if (error.message.includes('already been submitted')) {\n      return NextResponse.json(\n        {\n          error: 'This scenario has already been submitted',\n        },\n        { status: 409 }\n      );\n    }\n\n    return NextResponse.json(\n      {\n        error: error.message || 'Failed to publish scenario. Please try again.',\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,qBAAqB;QACrB,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,kBAAkB;QAClB,MAAM,YAAY,IAAA,yIAAoB,EAAC;QAEvC,4CAA4C;QAC5C,MAAM,YAAY;YAChB,iBAAiB,UAAU,eAAe;YAC1C,OAAO,KAAK,cAAc,IAAI,UAAU,KAAK;YAC7C,aAAa,KAAK,oBAAoB,IAAI,UAAU,WAAW;YAC/D,MAAM,UAAU,IAAI;YACpB,UAAU,KAAK,iBAAiB,IAAI,KAAK,QAAQ;YACjD,WAAW,UAAU,SAAS;YAC9B,WAAW,UAAU,SAAS;QAChC;QAEA,oBAAoB;QACpB,MAAM,SAAS,MAAM,IAAA,kIAAe,EAAC;QAErC,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;YACT,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,iBAAiB;QACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,YAAY,OAAO,UAAU;YAC7B,MAAM,OAAO,IAAI;YACjB,KAAK,CAAC,CAAC,EAAE,OAAO,IAAI,EAAE;YACtB,SAAS;QACX;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kBAAkB;QAEhC,6BAA6B;QAC7B,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,2BAA2B;YACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;YACT,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO,MAAM,OAAO,IAAI;QAC1B,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}